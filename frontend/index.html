<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NHADEC Web Chatbot</title>
    <style>
        body {
            font-family: sans-serif;
            max-width: 700px;
            margin: 0 auto;
            padding: 1rem;
        }

        input,
        button,
        textarea {
            padding: 0.5rem;
            margin-top: 0.5rem;
            width: 100%;
        }

        .chat {
            background: #f4f4f4;
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 6px;
        }

        .typing {
            color: #888;
        }

        .message {
            margin-top: 1rem;
            color: #333;
        }

        .error {
            color: red;
        }

        .success {
            color: green;
        }
    </style>
</head>

<body>
    <h1>Web Chatbot</h1>

    <label for="urlInput">Website URL:</label>
    <input id="urlInput" placeholder="https://example.com" />
    <button onclick="submitUrl()">Submit URL</button>

    <div id="urlStatus" class="message"></div>

    <hr />

    <label for="questionInput">Ask a question:</label>
    <textarea id="questionInput" rows="3" placeholder="Enter your question here..."></textarea>
    <button onclick="askQuestion()">Ask</button>

    <div id="chatBox" class="chat"></div>

    <script>
        const BACKEND = window.location.origin;

        async function submitUrl() {
            const url = document.getElementById("urlInput").value.trim();
            const statusBox = document.getElementById("urlStatus");
            statusBox.className = "message";
            statusBox.textContent = "üîÑ Scraping website, please wait...";

            try {
                const response = await fetch(`${BACKEND}/add_url`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ url })
                });

                const result = await response.json();
                statusBox.textContent = result.message || "Unknown response.";
                statusBox.className = result.message.startsWith("‚úÖ") ? "message success" : "message error";
            } catch (err) {
                console.error(err);
                statusBox.textContent = "‚ùå Failed to connect to backend.";
                statusBox.className = "message error";
            }
        }

        async function askQuestion() {
            const input = document.getElementById("questionInput").value.trim();
            const chatBox = document.getElementById("chatBox");
            if (!input) return;

            chatBox.innerHTML += `<p><strong>You:</strong> ${input}</p>`;
            chatBox.innerHTML += `<p class="typing">ü§ñ Typing...</p>`;
            chatBox.scrollTop = chatBox.scrollHeight;

            try {
                const response = await fetch(`${BACKEND}/ask`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ question: input })
                });

                const data = await response.json();
                document.querySelector(".typing").remove();
                chatBox.innerHTML += `<p><strong>Bot:</strong> ${data.answer || "‚ö†Ô∏è No answer received."}</p>`;
                chatBox.scrollTop = chatBox.scrollHeight;
            } catch (err) {
                console.error(err);
                document.querySelector(".typing").remove();
                chatBox.innerHTML += `<p class="error">‚ùå Error: Unable to contact backend.</p>`;
            }
        }
    </script>
</body>

</html>