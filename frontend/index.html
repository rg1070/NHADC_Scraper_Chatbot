<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Smart Scraper Chatbot</title>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <h1>Website Scraper Chatbot</h1>

    <input type="text" id="urlInput" placeholder="Enter website URL..." />
    <button onclick="addUrl()">Scrape Website</button>

    <div id="scrapedLinks"></div>

    <textarea id="questionInput" placeholder="Ask a question..."></textarea>
    <button onclick="ask()">Ask</button>
    <div id="responseOutput"></div>

    <div id="pagination"></div>

    <h3>Reference Domain</h3>
    <select id="siteDropdown" onchange="showGraph(this.value)">
        <option>Select a site...</option>
    </select>
    <div id="graphContainer"></div>

    <script>
        async function addUrl() {
            const url = document.getElementById('urlInput').value;
            const res = await fetch("/add_url", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ url })
            });
            const data = await res.json();
            alert(data.message);
            renderLinks(data.scraped_links);
            updateDropdown();
        }

        async function ask() {
            const question = document.getElementById('questionInput').value;
            const res = await fetch("/ask", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ question })
            });
            const data = await res.json();
            document.getElementById("responseOutput").innerText = data.answer;
        }

        function renderLinks(links) {
            const container = document.getElementById('scrapedLinks');
            container.innerHTML = "<h3>Scraped Pages</h3>";
            links.forEach(link => {
                container.innerHTML += `<div>${link}</div>`;
            });
        }

        async function updateDropdown() {
            const res = await fetch("/get_urls");
            const data = await res.json();
            const dropdown = document.getElementById("siteDropdown");
            dropdown.innerHTML = `<option>Select a site...</option>`;
            data.urls.forEach(url => {
                dropdown.innerHTML += `<option value="${url}">${url}</option>`;
            });
        }

        function showGraph(url) {
            const graphDiv = document.getElementById("graphContainer");
            graphDiv.innerHTML = `<iframe src="/static/graphs/${new URL(url).hostname}.json" width="100%" height="400px"></iframe>`;
        }

        window.onload = updateDropdown;
    </script>
</body>

</html>